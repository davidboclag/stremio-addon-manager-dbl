<!-- Componente Addons optimizado con Bootstrap 5.3 -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="card-title mb-0">
        Listado de Addons
        <span class="badge bg-info ms-2">{{ addons().length || 0 }}</span>
      </h5>

      <!-- Botones de acción -->
      <div class="btn-group btn-group-sm">
        <button
          class="btn btn-outline-secondary"
          (click)="refreshAddons()"
          [disabled]="loading()"
          title="Recargar addons"
          type="button"
        >
          <i class="bi bi-arrow-clockwise"></i> Recargar
        </button>
        <button
          class="btn btn-outline-primary"
          (click)="exportConfig()"
          [disabled]="addons().length === 0"
          title="Exportar configuración"
          type="button"
        >
          <i class="bi bi-download"></i> Exportar
        </button>
        <label
          class="btn btn-outline-success mb-0"
          for="importFile"
          title="Importar configuración"
        >
          <i class="bi bi-upload"></i> Importar
        </label>
        <input
          type="file"
          id="importFile"
          class="d-none"
          accept=".json"
          (change)="importConfig($event)"
        />
      </div>
    </div>

    <!-- Alert de autenticación -->
    @if (!stremioAuthKey) {
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      Debes iniciar sesión en Stremio para ver y editar los addons.
    </div>
    }

    <!-- Estado de carga -->
    @if (loading()) {
    <div class="d-flex justify-content-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
    }

    <!-- Lista simple de addons con CDK -->
    @if (addons().length > 0) {
    <ul class="list-group mb-3" cdkDropList (cdkDropListDropped)="drop($event)">
      @for (addon of addons(); track addon.transportUrl; let i = $index) {
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
        cdkDrag
        style="cursor: grab"
      >
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-grip-vertical text-secondary"></i>
          <img
            [src]="addon?.manifest?.logo || addon?.manifest?.icon"
            style="width: 28px; height: 28px; border-radius: 6px"
            [alt]="addon.manifest?.name || 'Addon'"
            (error)="onImageError($event)"
            *ngIf="addon?.manifest?.logo || addon?.manifest?.icon"
          />
          <strong>{{ addon.manifest?.name || addon.transportName }}</strong>
        </div>
        <div>
          <button
            class="btn btn-sm btn-outline-primary me-2"
            (click)="openAddon(addon.transportUrl)"
            type="button"
          >
            Abrir
          </button>
          <button
            class="btn btn-sm btn-outline-danger"
            (click)="
              deleteAddon(i, addon.manifest?.name || addon.transportName)
            "
            type="button"
          >
            Eliminar
          </button>
        </div>
      </li>
      }
    </ul>
    } @else if (!loading()) {
    <!-- Estado vacío -->
    <div class="text-center py-5 text-muted">
      <i class="bi bi-inbox display-1 mb-3 opacity-50"></i>
      <p class="mb-0">No hay addons cargados.</p>
    </div>
    }

    <!-- Acciones principales -->
    <div class="mt-3 d-flex justify-content-between">
      <button
        class="btn btn-success"
        (click)="saveToStremio()"
        [disabled]="!stremioAuthKey || loading()"
        type="button"
      >
        Sincronizar con Stremio
      </button>

      <button
        class="btn btn-outline-danger"
        (click)="deleteAll()"
        [disabled]="addons().length === 0"
        type="button"
      >
        Eliminar todos
      </button>
    </div>
  </div>
</div>
