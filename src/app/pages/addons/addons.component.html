<section class="card shadow-sm mb-4" aria-labelledby="addons-title">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 id="addons-title" class="card-title mb-0">
        Listado de Addons
        <span class="badge bg-info ms-2">{{ addons().length || 0 }}</span>
      </h2>
      <div class="btn-group btn-group-sm" role="group" aria-label="Acciones sobre addons">
        <button
          class="btn btn-outline-secondary"
          (click)="refreshAddons()"
          [disabled]="loading()"
          title="Recargar addons"
          type="button"
        >
          <i class="bi bi-arrow-clockwise"></i> Recargar
        </button>
        <button
          class="btn btn-outline-primary"
          (click)="exportConfig()"
          [disabled]="addons().length === 0"
          title="Exportar configuración"
          type="button"
        >
          <i class="bi bi-download"></i> Exportar
        </button>
        <label
          class="btn btn-outline-success mb-0"
          for="importFile"
          title="Importar configuración"
        >
          <i class="bi bi-upload"></i> Importar
        </label>
        <input
          type="file"
          id="importFile"
          class="d-none"
          accept=".json"
          (change)="importConfig($event)"
        />
      </div>
    </div>

    @if (!stremioAuthKey()) {
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      Debes iniciar sesión en Stremio para ver y editar los addons.
    </div>
    }

    @if (loading()) {
    <div class="d-flex justify-content-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
    }


    @if (!loading()) {
      @if (addons().length > 0) {
        <ul class="list-group mb-3" cdkDropList (cdkDropListDropped)="drop($event)" aria-label="Lista de addons">
          @for (addon of addons(); track addon.transportUrl; let i = $index) {
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
              cdkDrag
              style="cursor: grab"
            >
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-grip-vertical text-secondary"></i>
                <img
                  [src]="addon?.manifest?.logo || addon?.manifest?.icon"
                  style="width: 28px; height: 28px; border-radius: 6px"
                  [alt]="addon.manifest?.name || 'Addon'"
                  (error)="onImageError($event)"
                  *ngIf="addon?.manifest?.logo || addon?.manifest?.icon"
                />
                <strong>{{ addon.manifest?.name || addon.transportName }}</strong>
              </div>
              <div>
                <button
                  class="btn btn-sm btn-outline-primary me-2"
                  (click)="openAddon(addon.transportUrl)"
                  type="button"
                >
                  Abrir
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="deleteAddon(i, addon.manifest?.name || addon.transportName)"
                  type="button"
                >
                  Eliminar
                </button>
              </div>
            </li>
          }
        </ul>
      } @else {
        <div class="text-center text-muted my-4" role="status">
          <i class="bi bi-inbox fs-2"></i>
          <p class="mt-2">No hay addons disponibles.</p>
        </div>
      }
    }

    <!-- Acciones principales -->
    <div class="mt-3 d-flex justify-content-between">
      <button
        class="btn btn-success"
        (click)="saveToStremio()"
        [disabled]="!stremioAuthKey || loading()"
        type="button"
      >
        Sincronizar con Stremio
      </button>

      <button
        class="btn btn-outline-danger"
        (click)="deleteAll()"
        [disabled]="addons().length === 0"
        type="button"
      >
        Eliminar todos
      </button>
    </div>
  </div>
