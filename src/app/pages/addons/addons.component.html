<div class="card">
  <div class="card-body">
    <h5 class="card-title">
      Listado de Addons
      <span class="badge bg-info ms-2">{{ addons().length || 0 }}</span>
    </h5>

    @if (!stremioAuthKey) {
      <div class="alert alert-warning">
        Debes iniciar sesi√≥n en Stremio para ver y editar los addons.
      </div>
    }

    @if (loading()) {
      <div class="text-center py-3">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>
    }

    @if (addons().length > 0) {
      <ul class="list-group mb-3" cdkDropList (cdkDropListDropped)="drop($event)">
        @for (addon of addons(); track addon.transportUrl; let i = $index) {
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
            cdkDrag
            style="cursor: grab;"
          >
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-grip-vertical text-secondary"></i>
              @if (addon?.manifest?.logo || addon?.manifest?.icon) {
                <img
                  [src]="addon.manifest.logo || addon.manifest.icon"
                  style="width: 28px; height: 28px; border-radius: 6px"
                  [alt]="addon.manifest?.name || 'Addon'"
                />
              }
              <strong>{{ addon.manifest?.name || addon.transportName }}</strong>
            </div>
            <div>
              <button
                class="btn btn-sm btn-outline-primary me-2"
                (click)="openAddon(addon.transportUrl)"
              >
                Abrir
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="deleteAddon(i, addon.manifest?.name || addon.transportName)"
              >
                Eliminar
              </button>
            </div>
          </li>
        }
      </ul>
    } @else if (!loading()) {
      <div class="text-muted">
        No hay addons cargados.
      </div>
    }

    <div class="mt-3">
      <button
        class="btn btn-success"
        (click)="saveToStremio()"
        [disabled]="!stremioAuthKey || loading()"
      >
        @if (loading()) {
          <span class="spinner-border spinner-border-sm me-2"></span>
        }
        Sincronizar con Stremio
      </button>
      <button
        class="btn btn-outline-danger ms-2"
        (click)="deleteAll()"
        [disabled]="addons().length === 0"
      >
        Eliminar todos
      </button>
    </div>
  </div>
</div>
